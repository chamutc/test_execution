<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Management - Resource Scheduler</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/machine-management.css">
</head>
<body>
    <!-- Emergency Close Button -->
    <button class="emergency-close-btn" id="emergencyCloseBtn" title="Close All Modals (ESC)">‚úï</button>

    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1>üñ•Ô∏è Machine Management</h1>
                <nav class="main-navigation">
                    <a href="sessions-management.html" class="nav-link">üìã Sessions</a>
                    <a href="index.html" class="nav-link">üìÖ Timeline</a>
                    <a href="machine-management.html" class="nav-link active">üñ•Ô∏è Machine Management</a>
                    <a href="hardware-management.html" class="nav-link">üîß Hardware Management</a>
                </nav>
            </div>
        </header>

        <main class="main-content">
            <!-- Machine Management Section -->
            <section class="section">
                <div class="section-header">
                    <h2>üñ•Ô∏è Individual Machine Inventory</h2>
                    <div class="section-controls">
                        <button class="btn btn-primary" id="addMachineBtn">+ Add Machine</button>
                        <button class="btn btn-warning" id="bulkActivateBtn">‚úÖ Bulk Activate</button>
                        <button class="btn btn-secondary" id="bulkDeactivateBtn">‚ùå Bulk Deactivate</button>
                        <button class="btn btn-danger" id="bulkDeleteBtn">üóëÔ∏è Bulk Delete</button>
                        <button class="btn btn-info" id="machineAnalysisBtn">üìä Analysis</button>
                        <button class="btn btn-secondary" id="refreshMachinesBtn">üîÑ Refresh</button>
                    </div>
                </div>

                <!-- Search and Filter Controls -->
                <div class="filter-controls">
                    <div class="search-section">
                        <input type="text" id="machineSearch" placeholder="Search machines by name, OS, or description..." class="search-input">
                    </div>
                    <div class="filter-section">
                        <select id="statusFilter" class="filter-select">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="maintenance">Maintenance</option>
                        </select>
                        <select id="osFilter" class="filter-select">
                            <option value="">All OS Types</option>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                </div>

                <!-- Machine Statistics Summary -->
                <div class="machine-summary" id="machineSummary">
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="card-number" id="totalMachinesCount">0</div>
                            <div class="card-label">Total Machines</div>
                        </div>
                        <div class="summary-card">
                            <div class="card-number" id="activeMachinesCount">0</div>
                            <div class="card-label">Active</div>
                        </div>
                        <div class="summary-card">
                            <div class="card-number" id="inactiveMachinesCount">0</div>
                            <div class="card-label">Inactive</div>
                        </div>
                        <div class="summary-card">
                            <div class="card-number" id="osTypesCount">0</div>
                            <div class="card-label">OS Types</div>
                        </div>
                    </div>
                </div>

                <!-- Individual Machines Table -->
                <div class="machines-table-container">
                    <table class="machines-table" id="machinesTable">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAllMachines"></th>
                                <th>Machine Name</th>
                                <th>OS Type</th>
                                <th>Status</th>
                                <th>Location</th>
                                <th>Last Used</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="machinesTableBody">
                            <!-- Individual machines will be populated here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- OS Types Management Section -->
            <section class="section">
                <div class="section-header">
                    <h2>üíø Operating System Types</h2>
                    <div class="section-controls">
                        <button class="btn btn-success" id="addOSTypeBtn">+ Add OS Type</button>
                        <button class="btn btn-secondary" id="exportOSDataBtn">üì• Export</button>
                    </div>
                </div>
                
                <div class="os-types-container">
                    <div class="os-types-table-container" id="osTypesTableContainer">
                        <!-- OS Types table will be loaded here -->
                    </div>
                </div>
            </section>

            <!-- Machine Statistics Section -->
            <section class="section">
                <div class="section-header">
                    <h2>üìà Machine Statistics</h2>
                </div>
                
                <div class="stats-container">
                    <div class="stats-grid" id="machineStatsGrid">
                        <!-- Statistics will be loaded here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add Machine Modal -->
    <div class="modal-backdrop" id="addMachineModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Add New Machine</h3>
                <button class="modal-close" id="closeAddMachineModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMachineForm">
                    <div class="form-group">
                        <label for="machineName">Machine Name:</label>
                        <input type="text" id="machineName" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="machineOSType">Operating System:</label>
                        <select id="machineOSType" name="osType" required>
                            <option value="">Select OS Type...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="machineLocation">Location:</label>
                        <input type="text" id="machineLocation" name="location" placeholder="e.g., Lab A, Room 101">
                    </div>

                    <div class="form-group">
                        <label for="machineStatus">Status:</label>
                        <select id="machineStatus" name="status" required>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="maintenance">Maintenance</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="machineDescription">Description:</label>
                        <textarea id="machineDescription" name="description" rows="3" placeholder="Additional details about the machine..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="machineActive" name="active" checked>
                            Machine is active and available for scheduling
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelAddMachine">Cancel</button>
                <button type="submit" class="btn btn-primary" id="saveAddMachine">Save Machine</button>
            </div>
        </div>
    </div>

    <!-- Edit Machine Modal -->
    <div class="modal-backdrop" id="editMachineModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Edit Machine</h3>
                <button class="modal-close" id="closeEditMachineModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editMachineForm">
                    <input type="hidden" id="editMachineId" name="id">
                    
                    <div class="form-group">
                        <label for="editMachineName">Machine Name:</label>
                        <input type="text" id="editMachineName" name="name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editMachineOSType">Operating System:</label>
                        <select id="editMachineOSType" name="osType" required>
                            <option value="">Select OS Type...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editMachineQuantity">Quantity:</label>
                        <input type="number" id="editMachineQuantity" name="quantity" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editMachineLocation">Location:</label>
                        <input type="text" id="editMachineLocation" name="location">
                    </div>
                    
                    <div class="form-group">
                        <label for="editMachineDescription">Description:</label>
                        <textarea id="editMachineDescription" name="description" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="editMachineActive" name="active">
                            Machine is active and available for scheduling
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelEditMachine">Cancel</button>
                <button type="submit" class="btn btn-primary" id="saveEditMachine">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Add OS Type Modal -->
    <div class="modal-backdrop" id="addOSTypeModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Add OS Type</h3>
                <button class="modal-close" id="closeAddOSTypeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addOSTypeForm">
                    <div class="form-group">
                        <label for="osTypeName">OS Type Name:</label>
                        <input type="text" id="osTypeName" name="name" required placeholder="e.g., Windows 10, Ubuntu 20.04">
                    </div>
                    
                    <div class="form-group">
                        <label for="osTypeVersion">Version:</label>
                        <input type="text" id="osTypeVersion" name="version" placeholder="e.g., 20.04, 10.0.19041">
                    </div>
                    
                    <div class="form-group">
                        <label for="osTypeCategory">Category:</label>
                        <select id="osTypeCategory" name="category">
                            <option value="Windows">Windows</option>
                            <option value="Linux">Linux</option>
                            <option value="macOS">macOS</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="osTypeDescription">Description:</label>
                        <textarea id="osTypeDescription" name="description" rows="2" placeholder="Additional details about this OS type..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelAddOSType">Cancel</button>
                <button type="submit" class="btn btn-primary" id="saveAddOSType">Save OS Type</button>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer"></div>

    <!-- Scripts -->
    <script src="js/comprehensiveMachineManager.js"></script>
    <script>
        // Initialize comprehensive machine manager when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.comprehensiveMachineManager = new ComprehensiveMachineManager();

            // Handle Sessions navigation
            const sessionsLink = document.querySelector('a[href="index.html#sessions"]');
            if (sessionsLink) {
                sessionsLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = 'index.html#sessions';
                    // The main page will handle showing the sessions section
                });
            }

            // Emergency close button
            const emergencyCloseBtn = document.getElementById('emergencyCloseBtn');
            if (emergencyCloseBtn) {
                emergencyCloseBtn.addEventListener('click', () => {
                    // Close all modals
                    const modals = document.querySelectorAll('.modal-backdrop');
                    modals.forEach(modal => modal.remove());

                    const visibleModals = document.querySelectorAll('.modal');
                    visibleModals.forEach(modal => modal.style.display = 'none');

                    emergencyCloseBtn.classList.remove('show');
                });
            }

            // ESC key handler
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    const emergencyBtn = document.getElementById('emergencyCloseBtn');
                    if (emergencyBtn) {
                        emergencyBtn.click();
                    }
                }
            });
        });
    </script>
</body>
</html>
